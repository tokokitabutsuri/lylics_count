<!DOCTYPE html>

<head>
    <meta name="robots" content="noindex,nofollow">
</head>

<body>
    <h1>歌詞解析ツール</h1>
    <textarea id="lylics" placeholder="ここに歌詞を入力" style="width: 80vw;height: 50vh;"></textarea><br>
    <label>取得する数</label><input id="num" type="number" value="10" style="margin-right: 30px;width: 100px;">
    <button id="count">計測</button>
    <!--<input type="text" id="reptext" style="margin-right: 50px;">
    <button id="rep">置換</button>-->
    <hr>
    <div id="ans"></div>
    <script src="kuromoji/kuromoji.js"></script>
    <script>

        document.getElementById('count').addEventListener('click', async () => {
            let count = []
            let countedword = []
            let inputlylics = document.getElementById('lylics').value;
            let zyogai_pos = /記号/     //  /名詞|助詞|記号|接続詞|動詞|副詞|助動詞|形容詞|接頭詞|感動詞|連体詞/

            var newsegs = [];

            await kuromoji.builder({ dicPath: './kuromoji/dict/' }).build((err, tokenizer) => {
                const tokens = tokenizer.tokenize(inputlylics);// 解析データの取得
                let newtokens = []
                for (const token of tokens) {
                    if (!zyogai_pos.test(token.pos)) {
                        newtokens.push(token)
                    }
                }
                console.log(newtokens)
                newsegs = newtokens.map((obj) => obj.surface_form)
                console.log(newsegs)
                //ここで解析完了

                for (const seg of newsegs) {    //数を数える
                    let a = countedword.indexOf(seg);
                    if (a == -1) {
                        countedword.push(seg);
                        count.push(1);
                    } else {
                        count[a] += 1;
                    }
                }

                const aryMax = function (a, b) { return Math.max(a, b); }
                let ans = ""
                while ((ans.match(/\n/g) || []).length < document.getElementById('num').value) {
                    let max = count.reduce(aryMax);
                    let j = 0;
                    for (const reg of countedword) {
                        if (count[j] == max) {
                            ans = ans + reg + ':' + count[j] + '個' + '\n';
                            countedword.splice(j, 1);
                            count.splice(j, 1)
                        }
                        j++;
                    }
                    console.log(count)
                    console.log(countedword)
                    console.log(newsegs)
                    console.log(ans)
                }
                document.getElementById('ans').innerText = ans;
            });
        })

        document.getElementById('rep').addEventListener('click', () => {
            const inp = document.getElementById('lylics');
            inp.value = inp.value.replaceAll(document.getElementById('reptext').value, '。');
        })

        //alert(segs.join(" | "));  // 表示
    </script>
</body>